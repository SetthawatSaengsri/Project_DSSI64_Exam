<!-- add_exam_subject -->

{% extends 'app/base.html' %}

{% block content %}

<h2 class="text-3xl font-bold text-indigo-700 text-center mb-6">üìö ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</h2>

<form method="POST" class="space-y-6">
    {% csrf_token %}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤ -->
        <div>
            <label class="block text-lg font-medium text-gray-700">üìñ ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</label>
            <input type="text" name="subject_name" value="{{ form.subject_name.value|default_if_none:'' }}"
                class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
                required>
        </div>

        <!-- ‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤ -->
        <div>
            <label class="block text-lg font-medium text-gray-700">üî¢ ‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</label>
            <input type="text" name="subject_code" value="{{ form.subject_code.value|default_if_none:'' }}"
                class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
                required>
        </div>

        <!-- ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ -->
        <div>
            <label class="block text-lg font-medium text-gray-700">üìÖ ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
            <input type="text" name="academic_year" value="{{ form.academic_year.value|default_if_none:'' }}"
                class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
                required>
        </div>

        <!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö -->
        <div>
            <label class="block text-lg font-medium text-gray-700">üìÜ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö</label>
            <input type="date" name="exam_date" value="{{ form.exam_date.value|date:'Y-m-d' }}"
                class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
                required>
        </div>

        <!-- ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° -->
        <div>
            <label class="block text-lg font-medium text-gray-700">‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
            <input type="time" id="start_time" name="start_time"
                class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
                required>
        </div>

        <!-- ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î -->
        <div>
            <label class="block text-lg font-medium text-gray-700">‚è≥ ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
            <input type="time" id="end_time" name="end_time"
                class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
                required>
        </div>

        <!-- ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö -->
        <div class="md:col-span-2">
            <label class="block text-lg font-medium text-gray-700">üè´ ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö</label>
            <input type="text" name="room" value="{{ form.room.value|default_if_none:'' }}"
                class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
                required>
        </div>

        <!-- ‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏™‡∏≠‡∏ö -->
        <div class="md:col-span-2">
            <label class="block text-lg font-medium text-gray-700">üë®‚Äçüè´ ‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏™‡∏≠‡∏ö</label>
            <select name="invigilator"
                class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
                required>
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏™‡∏≠‡∏ö</option>
                {% for teacher in form.fields.invigilator.queryset %}
                <option value="{{ teacher.id }}">{{ teacher.user.get_full_name }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô -->
        <div class="md:col-span-2">
            <label class="block text-lg font-medium text-gray-700">üéì ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
            <select name="student_class" id="student_class"
                class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
                required>
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option>
                {% for class_value, class_label in form.fields.student_class.choices %}
                <option value="{{ class_value }}" {% if form.student_class.value == class_value %}selected{% endif %}>
                    {{ class_label }}
                </option>
                {% endfor %}
            </select>
        </div>        
    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å -->
    <div class="flex justify-between mt-6">
        <a href="{% url 'exam_subjects_staff' %}"
            class="bg-red-500 hover:bg-red-700 text-white px-8 py-4 text-lg rounded-md shadow-md transition">
            ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        </a>
        <button type="submit"
            class="bg-indigo-600 text-white px-10 py-4 text-lg rounded-md shadow-md hover:bg-indigo-700 transition">
            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        </button>
    </div>
</form>

<!-- ‚úÖ JavaScript ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ -->
<script>
    function convertToThaiTime(datetimeStr) {
        if (!datetimeStr) return "";
        let dateObj = new Date(datetimeStr);
        dateObj.setHours(dateObj.getHours() + 7); // ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏ã‡∏ô‡πÑ‡∏ó‡∏¢ (UTC+7)
        return dateObj.toISOString().slice(11, 16); // ‚úÖ ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö HH:MM
    }

    document.addEventListener("DOMContentLoaded", function () {
        let start_time_input = document.getElementById("start_time");
        let end_time_input = document.getElementById("end_time");

        let startTime = "{{ form.start_time.value|default_if_none:'' }}";
        let endTime = "{{ form.end_time.value|default_if_none:'' }}";

        if (startTime) start_time_input.value = convertToThaiTime(startTime);
        if (endTime) end_time_input.value = convertToThaiTime(endTime);
    });
</script>

{% endblock %}