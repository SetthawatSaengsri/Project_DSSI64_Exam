{% extends 'app/base.html' %}

{% block content %}
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
  <h2 class="text-3xl font-bold text-indigo-700 text-center mb-6">üìö ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</h2>

  {% if messages %}
  <div class="messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} p-4 mb-4 rounded-md shadow-md">
      {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <form method="POST" class="space-y-6">
    {% csrf_token %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏´‡πâ‡∏≠‡∏á -->
      <div class="md:col-span-2 p-4 bg-yellow-100 border border-yellow-300 rounded-md text-yellow-800 italic text-center">
        üè´ ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á
      </div>
      
      <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤ -->
      <div>
        <label class="block text-lg font-medium text-gray-700">üìñ ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</label>
        <input type="text" name="subject_name" value="{{ form.subject_name.value|default_if_none:'' }}"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤ -->
      <div>
        <label class="block text-lg font-medium text-gray-700">üî¢ ‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</label>
        <input type="text" name="subject_code" value="{{ form.subject_code.value|default_if_none:'' }}"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ -->
      <div>
        <label class="block text-lg font-medium text-gray-700">üìÖ ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
        <input type="text" name="academic_year" value="{{ form.academic_year.value|default_if_none:'' }}"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
      <div>
        <label class="block text-lg font-medium text-gray-700">üìò ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
        <select name="term"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
          {% for value, label in form.term.field.choices %}
            {% if value|stringformat:"s" == form.term.value|stringformat:"s" %}
              <option value="{{ value }}" selected>{{ label }}</option>
            {% else %}
              <option value="{{ value }}">{{ label }}</option>
            {% endif %}
          {% endfor %}
        </select>
      </div>

      <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö -->
      <div>
        <label class="block text-lg font-medium text-gray-700">üìÜ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö</label>
        <input type="date" name="exam_date" value="{{ form.exam_date.value|date:'Y-m-d' }}"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° -->
      <div>
        <label class="block text-lg font-medium text-gray-700">‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
        <input type="time" id="start_time" name="start_time" value="{{ form.start_time.value|default_if_none:'' }}"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î -->
      <div>
        <label class="block text-lg font-medium text-gray-700">‚è≥ ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
        <input type="time" id="end_time" name="end_time" value="{{ form.end_time.value|default_if_none:'' }}"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å -->
      <div class="md:col-span-2">
        <label class="block text-lg font-medium text-gray-700">üë®‚Äçüè´ ‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å</label>
        <select name="invigilator"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å</option>
          {% for teacher in form.fields.invigilator.queryset %}
            {% if teacher.id|stringformat:"s" == form.invigilator.value|stringformat:"s" %}
              <option value="{{ teacher.id }}" selected>{{ teacher.user.get_full_name }}</option>
            {% else %}
              <option value="{{ teacher.id }}">{{ teacher.user.get_full_name }}</option>
            {% endif %}
          {% endfor %}
        </select>
      </div>

      <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡∏£‡∏≠‡∏á -->
      <div class="md:col-span-2">
        <label class="block text-lg font-medium text-gray-700">üë®‚Äçüè´ ‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡∏£‡∏≠‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
        <select name="secondary_invigilator"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md">
          <option value="">‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
          {% for teacher in form.fields.secondary_invigilator.queryset %}
            {% if teacher.id|stringformat:"s" == form.secondary_invigilator.value|stringformat:"s" %}
              <option value="{{ teacher.id }}" selected>{{ teacher.user.get_full_name }}</option>
            {% else %}
              <option value="{{ teacher.id }}">{{ teacher.user.get_full_name }}</option>
            {% endif %}
          {% endfor %}
        </select>
      </div>

      <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô -->
      <div class="md:col-span-2">
        <label class="block text-lg font-medium text-gray-700">üéì ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
        <select name="student_class" id="student_class"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option>
          {% for class_value, class_label in form.fields.student_class.choices %}
            {% if class_value == form.student_class.value %}
              <option value="{{ class_value }}" selected>{{ class_label }}</option>
            {% else %}
              <option value="{{ class_value }}">{{ class_label }}</option>
            {% endif %}
          {% endfor %}
        </select>
      </div>

    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å -->
    <div class="flex justify-between mt-6">
      <a href="{% url 'exam_subjects_staff' %}"
        class="bg-red-500 hover:bg-red-700 text-white px-8 py-4 text-lg rounded-md shadow-md transition">
        ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      </a>
      <button type="submit"
        class="bg-indigo-600 text-white px-10 py-4 text-lg rounded-md shadow-md hover:bg-indigo-700 transition">
        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
      </button>
    </div>
  </form>
</div>

<script>
  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
  function formatDatetimeLocal(datetimeStr) {
    if (!datetimeStr) return "";
    let dateObj = new Date(datetimeStr);
    let tzOffset = dateObj.getTimezoneOffset() * 60000;
    let localISOTime = (new Date(dateObj.getTime() - tzOffset)).toISOString().slice(0, 16);
    return localISOTime;
  }

  document.addEventListener("DOMContentLoaded", function () {
    let startInput = document.getElementById("start_time");
    let endInput = document.getElementById("end_time");

    let startTime = "{{ form.start_time.value|default_if_none:'' }}";
    let endTime = "{{ form.end_time.value|default_if_none:'' }}";

    if (startTime) startInput.value = formatDatetimeLocal(startTime);
    if (endTime) endInput.value = formatDatetimeLocal(endTime);
  });
</script>
{% endblock %}
