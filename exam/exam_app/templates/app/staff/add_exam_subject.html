{% extends 'app/base.html' %}

{% block content %}
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
  <h2 class="text-3xl font-bold text-indigo-700 text-center mb-6">ğŸ“š à¹€à¸à¸´à¹ˆà¸¡à¸£à¸²à¸¢à¸§à¸´à¸Šà¸²</h2>

  {% if messages %}
  <div class="messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} p-4 mb-4 rounded-md shadow-md">
      {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <form method="POST" class="space-y-6">
    {% csrf_token %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- à¸Šà¸·à¹ˆà¸­à¸§à¸´à¸Šà¸² -->
      <div>
        <label class="block text-lg font-medium text-gray-700">ğŸ“– à¸Šà¸·à¹ˆà¸­à¸§à¸´à¸Šà¸²</label>
        <input type="text" name="subject_name" value="{{ form.subject_name.value|default_if_none:'' }}"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- à¸£à¸«à¸±à¸ªà¸§à¸´à¸Šà¸² -->
      <div>
        <label class="block text-lg font-medium text-gray-700">ğŸ”¢ à¸£à¸«à¸±à¸ªà¸§à¸´à¸Šà¸²</label>
        <input type="text" name="subject_code" value="{{ form.subject_code.value|default_if_none:'' }}"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² -->
      <div>
        <label class="block text-lg font-medium text-gray-700">ğŸ“… à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²</label>
        <input type="text" name="academic_year" value="{{ form.academic_year.value|default_if_none:'' }}"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸­à¸š -->
      <div>
        <label class="block text-lg font-medium text-gray-700">ğŸ“† à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸­à¸š</label>
        <input type="date" name="exam_date" value="{{ form.exam_date.value|date:'Y-m-d' }}"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡ -->
      <div>
        <label class="block text-lg font-medium text-gray-700">â° à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡</label>
        <input type="time" id="start_time" name="start_time"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- à¹€à¸§à¸¥à¸²à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸” -->
      <div>
        <label class="block text-lg font-medium text-gray-700">â³ à¹€à¸§à¸¥à¸²à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”</label>
        <input type="time" id="end_time" name="end_time"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- (à¸¥à¸š input à¸ªà¸³à¸«à¸£à¸±à¸š qr_expiration à¸­à¸­à¸à¹„à¸›) -->

      <!-- à¸«à¹‰à¸­à¸‡à¸ªà¸­à¸š -->
      <div class="md:col-span-2">
        <label class="block text-lg font-medium text-gray-700">ğŸ« à¸«à¹‰à¸­à¸‡à¸ªà¸­à¸š</label>
        <input type="text" name="room" value="{{ form.room.value|default_if_none:'' }}"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
      </div>

      <!-- à¸œà¸¹à¹‰à¸„à¸¸à¸¡à¸ªà¸­à¸šà¸«à¸¥à¸±à¸ -->
      <div class="md:col-span-2">
        <label class="block text-lg font-medium text-gray-700">ğŸ‘¨â€ğŸ« à¸œà¸¹à¹‰à¸„à¸¸à¸¡à¸ªà¸­à¸šà¸«à¸¥à¸±à¸</label>
        <select name="invigilator"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
          <option value="">à¹€à¸¥à¸·à¸­à¸à¸œà¸¹à¹‰à¸„à¸¸à¸¡à¸ªà¸­à¸šà¸«à¸¥à¸±à¸</option>
          {% for teacher in form.fields.invigilator.queryset %}
          <option value="{{ teacher.id }}">{{ teacher.user.get_full_name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- à¸œà¸¹à¹‰à¸„à¸¸à¸¡à¸ªà¸­à¸šà¸ªà¸³à¸£à¸­à¸‡ -->
      <div class="md:col-span-2">
        <label class="block text-lg font-medium text-gray-700">ğŸ‘¨â€ğŸ« à¸œà¸¹à¹‰à¸„à¸¸à¸¡à¸ªà¸­à¸šà¸ªà¸³à¸£à¸­à¸‡ (à¸–à¹‰à¸²à¸¡à¸µ)</label>
        <select name="secondary_invigilator"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md">
          <option value="">à¹„à¸¡à¹ˆà¹€à¸¥à¸·à¸­à¸</option>
          {% for teacher in form.fields.secondary_invigilator.queryset %}
          <option value="{{ teacher.id }}">{{ teacher.user.get_full_name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- à¹€à¸¥à¸·à¸­à¸à¸£à¸°à¸”à¸±à¸šà¸Šà¸±à¹‰à¸™ -->
      <div class="md:col-span-2">
        <label class="block text-lg font-medium text-gray-700">ğŸ“ à¸£à¸°à¸”à¸±à¸šà¸Šà¸±à¹‰à¸™</label>
        <select name="student_class" id="student_class"
          class="border-2 border-gray-300 bg-gray-100 focus:ring-indigo-500 focus:border-indigo-500 w-full p-4 text-lg rounded-md shadow-md"
          required>
          <option value="">à¹€à¸¥à¸·à¸­à¸à¸£à¸°à¸”à¸±à¸šà¸Šà¸±à¹‰à¸™</option>
          {% for class_value, class_label in form.fields.student_class.choices %}
          <option value="{{ class_value }}" {% if form.student_class.value == class_value %}selected{% endif %}>
            {{ class_label }}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>

    <!-- à¸›à¸¸à¹ˆà¸¡à¸šà¸±à¸™à¸—à¸¶à¸ -->
    <div class="flex justify-between mt-6">
      <a href="{% url 'exam_subjects_staff' %}"
        class="bg-red-500 hover:bg-red-700 text-white px-8 py-4 text-lg rounded-md shadow-md transition">
        âŒ à¸¢à¸à¹€à¸¥à¸´à¸
      </a>
      <button type="submit"
        class="bg-indigo-600 text-white px-10 py-4 text-lg rounded-md shadow-md hover:bg-indigo-700 transition">
        ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸
      </button>
    </div>
  </form>
</div>

<!-- âœ… JavaScript à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹€à¸§à¸¥à¸²à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¹€à¸§à¸¥à¸²à¸›à¸£à¸°à¹€à¸—à¸¨à¹„à¸—à¸¢ -->
<script>
  function convertToThaiTime(datetimeStr) {
    if (!datetimeStr) return "";
    let dateObj = new Date(datetimeStr);
    dateObj.setHours(dateObj.getHours() + 7); // à¹à¸›à¸¥à¸‡à¹€à¸§à¸¥à¸²à¹€à¸›à¹‡à¸™à¹‚à¸‹à¸™à¹„à¸—à¸¢ (UTC+7)
    return dateObj.toISOString().slice(11, 16); // à¸„à¸·à¸™à¸„à¹ˆà¸²à¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸š HH:MM
  }

  document.addEventListener("DOMContentLoaded", function () {
    let start_time_input = document.getElementById("start_time");
    let end_time_input = document.getElementById("end_time");

    let startTime = "{{ form.start_time.value|default_if_none:'' }}";
    let endTime = "{{ form.end_time.value|default_if_none:'' }}";

    if (startTime) start_time_input.value = convertToThaiTime(startTime);
    if (endTime) end_time_input.value = convertToThaiTime(endTime);
  });
</script>
{% endblock %}
