{% extends 'app/base.html' %}

{% block content %}

<div class="bg-white p-8 rounded-xl shadow-lg max-w-5xl px-4 mx-auto ">
    <h2 class="text-3xl font-bold text-indigo-800 mb-6 text-center">üìù ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</h2>

    <!-- Dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô -->
    <div class="flex justify-between items-center mb-6">
        <select id="gradeFilter" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500">
            <option value="all">üìö ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            {% for grade in grades %}
                <option value="{{ grade }}">{{ grade }}</option>
            {% endfor %}
        </select>
    </div>

    {% if subjects %}
    <div class="overflow-x-auto">
        <table class="w-full border-collapse bg-white shadow-md rounded-lg overflow-hidden">
            <thead class="bg-indigo-600 text-white">
                <tr>
                    <th class="py-3 px-6 text-left">#</th>
                    <th class="py-3 px-6 text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</th>
                    <th class="py-3 px-6 text-left">‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</th>
                    <th class="py-3 px-6 text-left">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</th>
                    <th class="py-3 px-6 text-center">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for subject in subjects %}
                <tr class="hover:bg-indigo-100 transition duration-200 subject-row" data-grade="{{ subject.grades|join:', ' }}">
                    <td class="py-4 px-6">{{ forloop.counter }}</td>
                    <td class="py-4 px-6">{{ subject.subject_name }}</td>
                    <td class="py-4 px-6">{{ subject.subject_code }}</td>
                    <td class="py-4 px-6">
                        {% for grade in subject.grades %}
                            <span class="bg-gray-200 text-gray-800 text-sm font-medium px-2 py-1 rounded">{{ grade }}</span>
                        {% empty %}
                            <span class="text-gray-500">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</span>
                        {% endfor %}
                    </td>
                    <td class="py-4 px-6 text-center">
                        <a href="{% url 'exam_attendance_status' subject.id %}" 
                           class="bg-indigo-600 text-white px-4 py-2 rounded-lg shadow hover:bg-indigo-700 transition">
                            ‚û°Ô∏è ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <p class="text-gray-500 text-lg text-center mt-6">‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</p>
    {% endif %}
</div>

<!-- JavaScript ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ -->
<script>
    document.getElementById("gradeFilter").addEventListener("change", function () {
        let selectedGrade = this.value;
        let rows = document.querySelectorAll(".subject-row");

        rows.forEach(row => {
            let gradeText = row.getAttribute("data-grade");
            let grades = gradeText ? gradeText.split(", ") : [];  // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å data-grade ‡πÄ‡∏õ‡πá‡∏ô list

            // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤
            if (selectedGrade === "all" || grades.includes(selectedGrade)) {
                row.style.display = "table-row";  
            } else {
                row.style.display = "none";  
            }
        });
    });
</script>

{% endblock %}
