<!-- app/staff/exam_detail.html -->

{% extends 'app/base.html' %}

{% load custom_filters %}

{% block content %}
<h2 class="text-3xl font-bold text-indigo-700 text-center mb-6">üìö ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö {{ subject.subject_name }}</h2>

<!-- üîπ ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏™‡∏≠‡∏ö
<h3 class="text-xl font-semibold text-gray-800 mb-4">üë®‚Äçüè´ ‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏™‡∏≠‡∏ö</h3>
<table class="min-w-full bg-white border border-gray-300 rounded-lg shadow-md">
    <thead class="bg-indigo-600 text-white">
        <tr>
            <th class="py-3 px-4 border-b">#</th>
            <th class="py-3 px-4 border-b">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            <th class="py-3 px-4 border-b">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</th>
        </tr>
    </thead>
    <tbody>
        {% for teacher in teachers %}
        <tr class="hover:bg-indigo-100 transition-all duration-200 ease-in-out">
            <td class="py-3 px-4 border-b">{{ forloop.counter }}</td>
            <td class="py-3 px-4 border-b">{{ teacher.user.first_name }} {{ teacher.user.last_name }}</td>
            <td class="py-3 px-4 border-b">
                {% if teacher.checkin_time %}
                    {{ teacher.checkin_time|date:"d/m/Y H:i:s" }}
                {% else %}
                    -
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table> -->

<!-- üîπ ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö -->
<h3 class="text-xl font-semibold text-gray-800 mt-8 mb-4">üéì ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö</h3>

<table class="min-w-full bg-white border border-gray-300 rounded-lg shadow-md">
    <thead class="bg-indigo-600 text-white">
        <tr>
            <th class="py-3 px-4 border-b">#</th>
            <th class="py-3 px-4 border-b">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
            <th class="py-3 px-4 border-b">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            <th class="py-3 px-4 border-b">‡∏ä‡∏±‡πâ‡∏ô</th>
            <th class="py-3 px-4 border-b">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏™‡∏≠‡∏ö</th>
            <th class="py-3 px-4 border-b">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö</th>
            <th class="py-3 px-4 border-b">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</th>
            <th class="py-3 px-4 border-b text-center">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
        </tr>
    </thead>
    <tbody>
        {% for student in students %}
        <tr class="hover:bg-indigo-100 transition-all duration-200 ease-in-out">
            <td class="py-3 px-4 border-b">{{ forloop.counter }}</td>
            <td class="py-3 px-4 border-b">{{ student.student_id }}</td>
            <td class="py-3 px-4 border-b">{{ student.user.first_name }} {{ student.user.last_name }}</td>
            <td class="py-3 px-4 border-b">{{ student.student_class }}</td>
            <td class="py-3 px-4 border-b">{{ student.seat_number }}</td>
            <td class="py-3 px-4 border-b">
                {% with attendance=attendance_dict|get_item:student.id %}
                    {% if attendance %}
                        {% if attendance.status == "on_time" %}
                            <span class="text-green-600 font-semibold">‡∏°‡∏≤</span>
                        {% elif attendance.status == "late" %}
                            <span class="text-yellow-600 font-semibold">‡∏°‡∏≤‡∏™‡∏≤‡∏¢</span>
                        {% elif attendance.status == "absent" %}
                            <span class="text-red-600 font-semibold">‡∏Ç‡∏≤‡∏î‡∏™‡∏≠‡∏ö</span>
                        {% else %}
                            <span class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</span>
                        {% endif %}
                    {% else %}
                        <span class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</span>
                    {% endif %}
                {% endwith %}
            </td>
            <td class="py-3 px-4 border-b">
                {% with attendance=attendance_dict|get_item:student.id %}
                    {% if attendance and attendance.checkin_time %}
                        {{ attendance.checkin_time|date:"d/m/Y H:i:s" }}
                    {% else %}
                        -
                    {% endif %}
                {% endwith %}
            </td>
            <td class="py-3 px-4 border-b text-center">
                <form method="POST" class="inline">
                    {% csrf_token %}
                    <input type="hidden" name="student_id" value="{{ student.id }}">
                    <select name="status" class="border rounded px-2 py-1">
                        <option value="on_time" {% if attendance_dict|get_item:student.id.status == 'on_time' %}selected{% endif %}>‡∏°‡∏≤</option>
                        <option value="late" {% if attendance_dict|get_item:student.id.status == 'late' %}selected{% endif %}>‡∏°‡∏≤‡∏™‡∏≤‡∏¢</option>
                        <option value="absent" {% if attendance_dict|get_item:student.id.status == 'absent' %}selected{% endif %}>‡∏Ç‡∏≤‡∏î‡∏™‡∏≠‡∏ö</option>
                    </select>
                    <button type="submit" class="bg-green-500 text-white px-3 py-1 rounded-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
