<!-- exam_detail.html -->

{% extends 'app/base.html' %}
{% load custom_filters %}

{% block content %}
<div class="container mx-auto my-12 max-w-6xl px-4 md:px-12">
  <!-- Header -->
  <div class="bg-gradient-to-r from-blue-700 to-indigo-700 rounded-lg py-10 shadow-2xl mb-12">
    <h2 class="text-5xl font-extrabold text-white text-center">
      üìö ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö: {{ subject.subject_name }}
    </h2>
  </div>

  <!-- Teacher Details Table -->
  <div class="mb-12">
    <h3 class="text-3xl font-semibold text-gray-800 text-center mb-6">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏™‡∏≠‡∏ö</h3>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white border border-gray-300 rounded-lg shadow-md">
        <thead class="bg-indigo-600 text-white">
          <tr>
            <th class="py-3 px-4 border-b">#</th>
            <th class="py-3 px-4 border-b">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            <th class="py-3 px-4 border-b">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
            <th class="py-3 px-4 border-b">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</th>
            <th class="py-3 px-4 border-b">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</th>
            <th class="py-3 px-4 border-b text-center">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
          </tr>
        </thead>
        <tbody>
          {% if subject.invigilator %}
          <tr class="hover:bg-indigo-100 transition-all duration-200 ease-in-out">
            <td class="py-3 px-4 border-b">1</td>
            <td class="py-3 px-4 border-b">
              {{ subject.invigilator.user.first_name }} {{ subject.invigilator.user.last_name }}
            </td>
            <td class="py-3 px-4 border-b">‡∏´‡∏•‡∏±‡∏Å</td>
            <td class="py-3 px-4 border-b">
              {% if subject.invigilator_checkin %}
                <span class="text-green-600 font-semibold">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß</span>
              {% else %}
                <span class="text-red-600 font-semibold">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</span>
              {% endif %}
            </td>
            <td class="py-3 px-4 border-b">-</td>
            <td class="py-3 px-4 border-b text-center">
              {% if not subject.invigilator_checkin %}
              <form method="POST" action="{% url 'confirm_exam_entry_teacher' %}" class="inline">
                {% csrf_token %}
                <input type="hidden" name="subject_id" value="{{ subject.id }}">
                <select name="status" class="border rounded px-2 py-1">
                  <option value="on_time">‡∏°‡∏≤</option>
                  <option value="absent">‡∏Ç‡∏≤‡∏î‡∏™‡∏≠‡∏ö</option>
                </select>
                <button type="submit" class="bg-green-500 text-white px-3 py-1 rounded-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
              </form>
              {% else %}
              <span class="text-gray-500">-</span>
              {% endif %}
            </td>
          </tr>
          {% endif %}
          {% if subject.secondary_invigilator %}
          <tr class="hover:bg-indigo-100 transition-all duration-200 ease-in-out">
            <td class="py-3 px-4 border-b">2</td>
            <td class="py-3 px-4 border-b">
              {{ subject.secondary_invigilator.user.first_name }} {{ subject.secondary_invigilator.user.last_name }}
            </td>
            <td class="py-3 px-4 border-b">‡∏™‡∏≥‡∏£‡∏≠‡∏á</td>
            <td class="py-3 px-4 border-b">
              {% if subject.secondary_invigilator_checkin %}
                <span class="text-green-600 font-semibold">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß</span>
              {% else %}
                <span class="text-red-600 font-semibold">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</span>
              {% endif %}
            </td>
            <td class="py-3 px-4 border-b">-</td>
            <td class="py-3 px-4 border-b text-center">
              {% if not subject.secondary_invigilator_checkin %}
              <form method="POST" action="{% url 'confirm_exam_entry_teacher' %}" class="inline">
                {% csrf_token %}
                <input type="hidden" name="subject_id" value="{{ subject.id }}">
                <select name="status" class="border rounded px-2 py-1">
                  <option value="on_time">‡∏°‡∏≤</option>
                  <option value="absent">‡∏Ç‡∏≤‡∏î‡∏™‡∏≠‡∏ö</option>
                </select>
                <button type="submit" class="bg-green-500 text-white px-3 py-1 rounded-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
              </form>
              {% else %}
              <span class="text-gray-500">-</span>
              {% endif %}
            </td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Student Attendance Table -->
  <div>
    <h3 class="text-3xl font-semibold text-gray-800 text-center mb-6">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö</h3>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white border border-gray-300 rounded-lg shadow-md">
        <thead class="bg-indigo-600 text-white">
          <tr>
            <th class="py-3 px-4 border-b">#</th>
            <th class="py-3 px-4 border-b">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
            <th class="py-3 px-4 border-b">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            <th class="py-3 px-4 border-b">‡∏ä‡∏±‡πâ‡∏ô</th>
            <th class="py-3 px-4 border-b">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏™‡∏≠‡∏ö</th>
            <th class="py-3 px-4 border-b">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th class="py-3 px-4 border-b">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</th>
            <th class="py-3 px-4 border-b text-center">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
          </tr>
        </thead>
        <tbody>
          {% for student in students %}
          <tr class="hover:bg-indigo-100 transition-all duration-200 ease-in-out">
            <td class="py-3 px-4 border-b">{{ forloop.counter }}</td>
            <td class="py-3 px-4 border-b">{{ student.student_id }}</td>
            <td class="py-3 px-4 border-b">{{ student.user.first_name }} {{ student.user.last_name }}</td>
            <td class="py-3 px-4 border-b">{{ student.student_class }}</td>
            <td class="py-3 px-4 border-b">{{ student.seat_number }}</td>
            <td class="py-3 px-4 border-b">
              {% with attendance=attendance_dict|get_item:student.id %}
                {% if attendance %}
                  {% if attendance.status == "on_time" %}
                    <span class="text-green-600 font-semibold">‡∏°‡∏≤</span>
                  {% elif attendance.status == "late" %}
                    <span class="text-yellow-600 font-semibold">‡∏°‡∏≤‡∏™‡∏≤‡∏¢</span>
                  {% elif attendance.status == "absent" %}
                    <span class="text-red-600 font-semibold">‡∏Ç‡∏≤‡∏î‡∏™‡∏≠‡∏ö</span>
                  {% else %}
                    <span class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</span>
                  {% endif %}
                {% else %}
                  <span class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</span>
                {% endif %}
              {% endwith %}
            </td>
            <td class="py-3 px-4 border-b">
              {% with attendance=attendance_dict|get_item:student.id %}
                {% if attendance and attendance.checkin_time %}
                  {{ attendance.checkin_time|date:"d/m/Y H:i:s" }}
                {% else %}
                  -
                {% endif %}
              {% endwith %}
            </td>
            <td class="py-3 px-4 border-b text-center">
              <form method="POST" class="inline">
                {% csrf_token %}
                <input type="hidden" name="student_id" value="{{ student.id }}">
                <select name="status" class="border rounded px-2 py-1">
                  {% with record=attendance_dict|get_item:student.id %}
                    <option value="on_time" {% if record and record.status == 'on_time' %}selected{% endif %}>‡∏°‡∏≤</option>
                    <option value="late" {% if record and record.status == 'late' %}selected{% endif %}>‡∏°‡∏≤‡∏™‡∏≤‡∏¢</option>
                    <option value="absent" {% if record and record.status == 'absent' %}selected{% endif %}>‡∏Ç‡∏≤‡∏î‡∏™‡∏≠‡∏ö</option>
                  {% endwith %}
                </select>
                <button type="submit" class="bg-green-500 text-white px-3 py-1 rounded-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
