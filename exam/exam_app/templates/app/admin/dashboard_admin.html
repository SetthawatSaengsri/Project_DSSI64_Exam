<!-- app/admin/dashboard_admin.html -->

<!-- app/admin/dashboard_admin.html -->
{% extends "app/base.html" %}

{% block content %}
<div class="container mx-auto mt-10 max-w-7xl px-6 md:px-12">
  <h2 class="text-4xl font-bold text-indigo-700 text-center mb-12">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h2>

  <!-- üîπ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      {% for card in overview_cards %}
      <div class="bg-{{ card.color }}-100 p-6 rounded-2xl shadow-md flex items-center">
          <div class="text-{{ card.color }}-700 text-5xl">{{ card.icon }}</div>
          <div class="ml-5">
              <h3 class="text-xl font-semibold text-{{ card.color }}-700">{{ card.label }}</h3>
              <p class="text-4xl font-bold text-gray-800 mt-2" id="{{ card.label|slugify }}">{{ card.count }}</p>
          </div>
      </div>
      {% endfor %}
  </div>

  <!-- üîπ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö -->
  <div class="mt-16">
      <h3 class="text-2xl font-semibold text-gray-800 mb-4">üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö</h3>

      <div class="flex flex-col md:flex-row justify-center items-center gap-6 mb-6">
          <div>
              <label for="academicYearFilter" class="font-medium text-gray-700 mr-2">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</label>
              <select id="academicYearFilter" class="p-2 border border-gray-300 rounded-md">
                  <option value="all">üìå ‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                  {% for year in year_list %}
                  <option value="{{ year }}">{{ year }}</option>
                  {% endfor %}
              </select>
          </div>
          <div>
              <label for="classFilter" class="font-medium text-gray-700 mr-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô:</label>
              <select id="classFilter" class="p-2 border border-gray-300 rounded-md">
                  <option value="all">üìå ‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option>
                  {% for class_name in class_list %}
                  <option value="{{ class_name }}">{{ class_name }}</option>
                  {% endfor %}
              </select>
          </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="bg-white p-6 rounded-xl shadow-lg">
              <h4 class="text-center text-lg font-semibold text-gray-700 mb-4">üìä ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö</h4>
              <canvas id="barChart"></canvas>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-lg">
              <h4 class="text-center text-lg font-semibold text-gray-700 mb-4">üìà ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö</h4>
              <canvas id="pieChart"></canvas>
          </div>
      </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    // ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ attendance_data ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å view ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON
    let attendanceData = {{ attendance_data|safe }};
    
    // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á elements ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏á
    const classFilter = document.getElementById("classFilter");
    const yearFilter = document.getElementById("academicYearFilter");
    // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á elements ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (overview cards)
    // ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ id ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å slugify label (‡πÄ‡∏ä‡πà‡∏ô "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏π", "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤")
    const teacherCount = document.getElementById("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏π");
    const studentCount = document.getElementById("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");
    const subjectCount = document.getElementById("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤");

    function updateCharts(className) {
        let data = attendanceData[className] || attendanceData["all"];
        teacherCount.innerText = data.total_teachers;
        studentCount.innerText = data.total_students;
        subjectCount.innerText = data.total_subjects;
        let onTime = data.on_time || 0;
        let late = data.late || 0;
        let absent = data.absent || 0;
        barChart.data.datasets[0].data = [onTime, late, absent];
        pieChart.data.datasets[0].data = [onTime, late, absent];
        barChart.update();
        pieChart.update();
    }

    const barChart = new Chart(document.getElementById("barChart"), {
        type: "bar",
        data: {
            labels: ["‡∏°‡∏≤‡∏ï‡∏£‡∏á‡πÄ‡∏ß‡∏•‡∏≤", "‡∏°‡∏≤‡∏™‡∏≤‡∏¢", "‡∏Ç‡∏≤‡∏î‡∏™‡∏≠‡∏ö"],
            datasets: [{
                label: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô",
                data: [attendanceData["all"].on_time || 0, attendanceData["all"].late || 0, attendanceData["all"].absent || 0],
                backgroundColor: ["#16a34a", "#facc15", "#dc2626"]
            }]
        },
        options: { responsive: true }
    });

    const pieChart = new Chart(document.getElementById("pieChart"), {
        type: "pie",
        data: {
            labels: ["‡∏°‡∏≤‡∏ï‡∏£‡∏á‡πÄ‡∏ß‡∏•‡∏≤", "‡∏°‡∏≤‡∏™‡∏≤‡∏¢", "‡∏Ç‡∏≤‡∏î‡∏™‡∏≠‡∏ö"],
            datasets: [{
                data: [attendanceData["all"].on_time || 0, attendanceData["all"].late || 0, attendanceData["all"].absent || 0],
                backgroundColor: ["#16a34a", "#facc15", "#dc2626"]
            }]
        },
        options: { responsive: true }
    });

    classFilter.addEventListener("change", () => updateCharts(classFilter.value));
});
</script>
{% endblock %}

