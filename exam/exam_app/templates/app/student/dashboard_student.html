{% extends "app/base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto py-12 px-6 sm:px-8 lg:px-10 text-center">
    <h2 class="text-3xl font-bold text-indigo-700 mb-6">ЁЯОл р╕кр╣Бр╕Бр╕Щ QR Code р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕кр╕нр╕Ъ</h2>

    <!-- р╕Ыр╕╕р╣Ир╕бр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Ыр╕┤р╕Фр╕Бр╕ер╣Йр╕нр╕Зр╣Бр╕ер╕░р╕кр╣Бр╕Бр╕Щ QR Code -->
    <button id="scan-btn" class="bg-blue-600 text-white px-6 py-3 text-lg rounded-xl shadow-lg transition-transform transform hover:scale-105">
        ЁЯУ╖ р╕кр╣Бр╕Бр╕Щ QR Code
    </button>

    <!-- р╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣Ир╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Бр╕ер╣Йр╕нр╕Зр╕кр╣Бр╕Бр╕Щ -->
    <div id="qr-reader" style="width: 100%; height: 300px;"></div>

    <!-- р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ -->
    <div id="scan-result" class="mt-4 text-xl text-blue-600 hidden">
        <p>р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕кр╣Бр╕Бр╕Щр╣Др╕Фр╣Й:</p>
        <pre id="result-output"></pre>
    </div>
</div>

<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>

<script>
    // р╣Ар╕бр╕╖р╣Ир╕нр╕Др╕ер╕┤р╕Бр╕Ыр╕╕р╣Ир╕бр╕кр╣Бр╕Бр╕Щ
    document.getElementById("scan-btn").addEventListener("click", function() {
        console.log("р╕Ыр╕╕р╣Ир╕бр╕Цр╕╣р╕Бр╕Бр╕Фр╣Бр╕ер╣Йр╕з");
        startScanner();  // р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ
    });

    function startScanner() {
        console.log("р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ QR Code");

        const html5QrCode = new Html5Qrcode("qr-reader");

        // р╣Ар╕гр╕┤р╣Ир╕бр╕кр╣Бр╕Бр╕Щр╕Ир╕▓р╕Бр╕Бр╕ер╣Йр╕нр╕З
        html5QrCode.start(
            { facingMode: "environment" },  // р╣Гр╕Кр╣Йр╕Бр╕ер╣Йр╕нр╕Зр╕лр╕ер╕▒р╕Зр╕Вр╕нр╕Зр╕нр╕╕р╕Ыр╕Бр╕гр╕Ур╣М
            { fps: 10, qrbox: 250 }, // р╕Бр╕│р╕лр╕Щр╕Ф fps р╣Бр╕ер╕░р╕Вр╕Щр╕▓р╕Фр╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣Ир╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╕кр╣Бр╕Бр╕Щ
            (decodedText) => {
                // р╣Ар╕бр╕╖р╣Ир╕нр╕кр╣Бр╕Бр╕Щ QR Code р╕кр╕│р╣Ар╕гр╣Зр╕И
                console.log("р╕кр╣Бр╕Бр╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И: " + decodedText);  // р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕кр╣Бр╕Бр╕Щр╣Др╕Фр╣Й
                document.getElementById("scan-result").classList.remove("hidden");
                document.getElementById("result-output").textContent = decodedText; // р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Др╕Фр╣Йр╕Ир╕▓р╕Бр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ

                // р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щр╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕кр╣Бр╕Бр╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И
                html5QrCode.stop().then(() => {
                    console.log("QR Code Scanning stopped.");
                }).catch(err => {
                    console.error("Error stopping scanning:", err);
                });
            },
            (errorMessage) => {
                // р╕лр╕▓р╕Бр╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ
                console.log("Error scanning:", errorMessage);
            }
        ).catch((err) => {
            console.error("Error starting scanner:", err); // р╕лр╕▓р╕Бр╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щр╣Др╕Фр╣Й
        });
    }
</script>

{% endblock %}
